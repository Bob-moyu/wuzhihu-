

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>墨羽的博客</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <meta http-equiv="Cache-Control" content="no-siteapp"/>
        <link rel="icon" type="image/png" href="assets/i/favicon.png">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/fontAwesome.css">
        <link rel="stylesheet" href="css/light-box.css">
        <link rel="stylesheet" href="css/owl-carousel.css">
        <link rel="stylesheet" href="css/templatemo-style.css">
        <link rel="stylesheet" href="assets/css/amazeui.min.css">
        <link rel="stylesheet" href="assets/css/amazeui.min.css">
        <link rel="stylesheet" href="assets/css/app.css">
        <link rel="stylesheet" href="editor.md/css/editormd.css" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">

        <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
        <!--style标签中写的就是css-->
        <style>
            [v-cloak]{
                display:none;
            }
        </style>
    </head>

<body>



        <header class="nav-down responsive-nav hidden-lg hidden-md">
            <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--/.navbar-header-->
            <div id="main-nav" class="collapse navbar-collapse">
                <nav>
                    <ul class="nav navbar-nav">
                        <li><a href="#top">个人主页</a></li>
                        <li><a href="#blog">博客</a></li>
                        <li><a href="#contact">联系我们</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="sidebar-navigation hidde-sm hidden-xs">
            <div class="logo">
                <a href="#">选<em>项</em></a>
            </div>
            <nav>
                <ul>
                    <li>
                        <a href="#top">
                            <span class="rect"></span>
                            <span class="circle"></span>
                            个人主页
                        </a>
                    </li>
                    <li>
                        <a href="#blog">
                            <span class="rect"></span>
                            <span class="circle"></span>
                            博客
                        </a>
                    </li>
                    <li>
                        <a href="#contact">
                            <span class="rect"></span>
                            <span class="circle"></span>
                            联系我们
                        </a>
                    </li>
                </ul>>
            </nav> 
                    <ul class="social-icons">
                            <li><a href="https://github.com/WZH-moyu"><i class="fa fa-github"></i></a></li>
                            <li><a href="#"><i class="fa fa-wechat"></i></a></li>
                            <li><a href="https://mp.qzone.qq.com/u/445163140?uin=445163140&is_famous_space=1&brand_flag=0&g_f=2000000393"><i class="fa fa-qq"></i></a></li>
                    </ul>           
        </div>

        <div class="slider">
            <div class="Modern-Slider content-section" id="top">
                <!-- Item -->
                <!-- // Item -->
                <!-- Item -->
                <div class="item item-3">
                    <div class="img-fill">
                        <div class="image"></div>
                        <div class="info">
                        <div>
                          <h1>吴治虎的博客乐园</h1>
                          <p>Nothing is impossible</p>
                          <p>姓名：吴治虎</p>
                          <p>联系电话：15009291916</p>
                          <p>爱好：音乐</p>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- // Item -->
            </div>
        </div>


        <div class="page-content">
            <section id="blog" class="content-section">
                <div class="section-heading">
                    <h1>博客<br><em>乐园</em></h1>
                    <p>遇见最美的自己同时遇见你！</p>
                </div>
                <div class="section-content">
                    <div class="tabs-content">
                        <div class="wrapper" id="app">
                            <ul class="tabs clearfix" data-tabgroup="app">
                              <li><a href="#tab1" class="active">博客列表</a></li>
                              <li><a href="#tab2" class="active">标签列表</a></li>
                            </ul>
                            <section id="first-tab-group" class="tabgroup">
                                <div id="tab1">
                                    <ul>
                                       <li> 
                                           <div v-show="blog.blog_id==null" >
                                                <article class="item" v-for="blog in blogs" v-cloak>
                                                    <div class="div-left">
                                                        <div class="text-content">
                                                            <!--v-on:click把当前的html标签关联上一个鼠标点击事件-->
                                                            <h1><a v-on:click="get_blog(blog.blog_id)">{{blog.title}}</a></h1><span>{{tag_id2name(blog.tag_id)}}</span>     
                                                            <span>{{blog.create_time}}</span><span>{{author}}</span>
                                                            <button type="button" class="am-btn am-btn-danger am-round" v-on:click="delete_blog(blog.blog_id)">删除博客</button>
                                                            <p><a href="" class="blog-continue">continue reading</a></p>
                                                        </div>
                                                    </div>
                                                </article>
                                           </div>
                                        </li>   
                                    </ul>
                                    <ul>
                                       <li> 
                                           <div v-show="blog.blog_id!=null">
                                            <div class="am-form">
                                                <div class="am-form-group">
                                                    <label for="doc-ipt-email-1">博客标题</label>
                                                    <input type="text" class="" v-model="blog.title">
                                                </div>
                                            </div>
                                            <!--先使用 editor.md 完成 markdown 到 html 的转换-->
                                            <article id="blog_view">
                                                <textarea>{{blog.content}}</textarea>
                                            </article>
                                            <button type="button" class="am-btn am-btn-success am-round" v-on:click="update_blog(blog.blog_id)">提交</button>
                                            <button type="button" class="am-btn am-btn-success am-round" v-on:click="back()">返回</button>
                                           </div>
                                        </li>   
                                    </ul>
                                </div> 
                                <div id="tab2">
                                        <ul>
                                            <li> 
                                                <div class="blog-clear-margin blog-sidebar-widget blog-bor am-g ">
                                                    <div class="am-u-sm-12 blog-clear-padding" v-cloak>
                                                        <h2><a href="" class="blog-tag" v-for="tag in tags">{{tag.tag_id}}&nbsp;{{tag.tag_name}}<br/></a></h2>
                                                    </div>
                                                </div>
                                            </li>   
                                        </ul>
                                    </div>
                            </section>
                        </div>
                    </div>
                </div>
            </section>
            <section id="contact" class="content-section">
                <div id="contact-content">
                    <div class="section-heading">
                        <h1><em>请写下你的意见</em></h1>
                        <p><em>我会及时阅览并改正，期待遇见更好的我！</em></p>
                        
                    </div>
                    <div class="section-content">
                        <form id="contact" action="#" method="post">
                            <div class="row">
                                <div class="col-md-4">
                                  <fieldset>
                                    <input name="name" type="text" class="form-control" id="name" placeholder="你的姓名" required="">
                                  </fieldset>
                                </div>
                                <div class="col-md-4">
                                  <fieldset>
                                    <input name="email" type="email" class="form-control" id="email" placeholder="你的邮箱" required="">
                                  </fieldset>
                                </div>
                                 <div class="col-md-4">
                                  <fieldset>
                                    <input name="subject" type="text" class="form-control" id="subject" placeholder="话题" required="">
                                  </fieldset>
                                </div>
                                <div class="col-md-12">
                                  <fieldset>
                                    <textarea name="message" rows="6" class="form-control" id="message" placeholder="你的见解" required></textarea>
                                  </fieldset>
                                </div>
                                <div class="col-md-12">
                                  <fieldset>
                                    <button type="submit" id="form-submit" class="btn">立即发送</button>
                                  </fieldset>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
            <section class="footer">
                <p>Copyright &copy; 2018 by 吴治虎</p>
            </section>
        </div>
    <script src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>')</script>

    <script src="js/vendor/bootstrap.min.js"></script>
    
    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>

    <script>
        // Hide Header on on scroll down
        var didScroll;
        var lastScrollTop = 0;
        var delta = 5;
        var navbarHeight = $('header').outerHeight();

        $(window).scroll(function(event){
            didScroll = true;
        });

        setInterval(function() {
            if (didScroll) {
                hasScrolled();
                didScroll = false;
            }
        }, 250);

        function hasScrolled() {
            var st = $(this).scrollTop();
            
            // Make sure they scroll more than delta
            if(Math.abs(lastScrollTop - st) <= delta)
                return;
            
            // If they scrolled down and are past the navbar, add class .nav-up.
            // This is necessary so you never see what is "behind" the navbar.
            if (st > lastScrollTop && st > navbarHeight){
                // Scroll Down
                $('header').removeClass('nav-down').addClass('nav-up');
            } else {
                // Scroll Up
                if(st + $(window).height() < $(document).height()) {
                    $('header').removeClass('nav-up').addClass('nav-down');
                }
            }
            
            lastScrollTop = st;
        }
    </script>
    <script src="assets/js/jquery.min.js"></script>

    <script src="assets/js/amazeui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="editor.md/lib/marked.min.js"></script>
    <script src="editor.md/lib/prettify.min.js"></script>
    <script src="editor.md/lib/raphael.min.js"></script>
    <script src="editor.md/lib/underscore.min.js"></script>
    <script src="editor.md/lib/sequence-diagram.min.js"></script>
    <script src="editor.md/lib/flowchart.min.js"></script>
    <script src="editor.md/lib/jquery.flowchart.min.js"></script>
    <script src="editor.md/editormd.js"></script>
    <script>
        var app = new Vue({
            el:'#app',//el表示 app 这个Vue对象和哪个http关联
            data:{
                //data 表示所有需要在页面上动态变化的数据
                //把js中的数据和界面的内容关联在一起，叫做数据绑定
                author:'吴治虎',
                blogs:[
                ],
                tags:[
                ],
                //blog用来保存当前页面上博客的详细内容
                blog:{
                    blog_id:null,
                    title:null,
                    content:null,
                    create_time:null,
                    tag_id:null
                }

            },
            methods:{
                tag_id2name(tag_id){
                    //this访问到当前的app
                    //this.tags就相当于上面定义的标签数组
                    for(var index in this.tags)
                    {
                        if(this.tags[index].tag_id==tag_id)
                            return this.tags[index].tag_name;
                    }
                    return "默认分类";
                },
                get_blogs(tag_id){
                    var url = '/blog';
                    if(tag_id!=null){
                        url = '/blog/?tag_id=' + tag_id;
                    }
                    //核心操作，访问http服务器的数据
                    //使用JQuery提供的API
                    $.ajax({
                        url:url,
                        type:"get",
                        context:this,
                        success:function(data,status){
                            //data表示响应的body数据，status表示返回的状态码
                            //http请求执行成功之后执行，更新数据
                            //如果不设置context，直接使用this.blogs是会出错的
                            //此时的this表示的当前$这样的jquery对象，而不是Vue对象
                            //加上context之后，this就表示
                            this.blogs = data;
                        }
                    })
                },
            init() {
            // 1. 从服务器上获取 tag
            $.ajax({
                type: "get",
                url: "/tag",
                context: this,
                success: function(data, status) {
                    this.tags = data;
                    // 2. 从服务器上获取博客
                    // 更建议大家把 get_blogs 写到回调内部
                    // 因为需要先获取到 tag 信息, 然后才能获取 博客 列表, 否则 tag_id 和 tag_name 的映射关系无法正确建立. 
                    this.get_blogs();
                }
            })
        },
        // 点击博客标题的时候来调用这个函数
        get_blog(blog_id) {
            $.ajax({
                url: '/blog/' + blog_id,
                type: "get",
                context: this,
                success: function(data, status) {
                    // 此时得到的 blog.content 是 markdown 格式的数据
                    this.blog = data;
                    // 把这个 markdown 格式的数据转成 html, 并显示在界面上
                    testEditormdView = editormd.markdownToHTML("blog_view", {
                        markdown        : this.blog.content ,//+ "\r\n" + $("#append-test").text(),
                        //htmlDecode      : true,       // 开启 HTML 标签解析，为了安全性，默认不开启
                        htmlDecode      : "style,script,iframe",  // you can filter tags decode
                        //toc             : false,
                        tocm            : true,    // Using [TOCM]
                        //tocContainer    : "#custom-toc-container", // 自定义 ToC 容器层
                        //gfm             : false,
                        //tocDropdown     : true,
                        // markdownSourceCode : true, // 是否保留 Markdown 源码，即是否删除保存源码的 Textarea 标签
                        emoji           : true,
                        taskList        : true,
                        tex             : true,  // 默认不解析
                        flowChart       : true,  // 默认不解析
                        sequenceDiagram : true,  // 默认不解析
                    });

                }
            })
        },
        delete_blog(blog_id) {
            $.ajax({
                type: "delete",
                url: '/blog/' + blog_id,
                context: this,
                success: function(data, status) {
                    this.get_blogs();
                    // 弹出对话框提示删除成功
                    alert("删除成功");
                }
            })
        },
        edit_blog(blog_id) {
            // 1. 先把之前的博客数据先清空
            this.blog = {};
            // 2. ajax 获取到当前点击的博客内容
            $.ajax({
                type: "get",
                url: "/blog/" + blog_id,
                context: this,
                success: function(data, status) {
                    this.blog = data;
                    // 3. 根据数据加载 markdown 编辑器
                    testEditor = editormd("blog_view", {
                        width: "100%",
                        height: "700px",
                        syncScrolling: "single",
                        path: "editor.md/lib/"
                    });
                }
            })
        },
        back() {
            this.blog = {};
        },
        update_blog(blog_id) {
            // 从编辑器中获取到修改后的 markdown 数据
            var content = testEditor.getMarkdown();
            var body = {
                title: this.blog.title,
                content: this.blog.content, // 此处需要得到修改后的内容
                tag_id: this.blog.tag_id
            }
            $.ajax({
                type: "put",
                url: "/blog/" + blog_id,
                data: JSON.stringify(body),
                contentType: 'application/json;charset=utf-8',
                context: this,
                success: function(data, status) {
                    this.get_blogs();
                    alert("提交成功");
                    this.back();
                }
            })
        }
        }
        });
        //初始化的获取数据操作
        app.init();
        </script>

</body>
</html>